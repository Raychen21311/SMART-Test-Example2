<!DOCTYPE html>
<html>
<head>
    <!-- 設定文件使用 UTF-8 編碼 -->
    <meta charset="UTF-8">

    <!-- 瀏覽器頁籤顯示的標題 -->
    <title>Launch App</title>

    <!-- 載入 SMART on FHIR 官方 JavaScript SDK
         提供 OAuth2、FHIR client 初始化等功能 -->
    <script src="https://cdn.jsdelivr.net/npm/fhirclient/build/fhir-client.js"></script>
</head>

<body>
<script>
    // 清除 sessionStorage
    // 避免前一次登入或舊 token 影響本次啟動
    sessionStorage.clear();

    // 清除 localStorage
    // 在開發與測試階段很重要，確保每次都是「乾淨啟動」
    localStorage.clear();

    // 啟動 SMART on FHIR OAuth2 授權流程
    FHIR.oauth2.authorize({
        // SMART App 在 FHIR Server 上註冊的 Client ID
        clientId: "Client_ID",

        // OAuth scope：
        // openid        → 取得使用者身份資訊
        // fhirUser      → 取得目前登入使用者（醫師/系統）資訊
        // patient/*.read→ 允許讀取病患相關 FHIR 資源
        //
        // 注意：
        // 這裡「沒有使用 launch/patient」
        // 代表不是從單一病患情境啟動，
        // 而是要自己做「病患選擇頁面」
        scope: "openid fhirUser patient/*.read",

        // OAuth 完成後導向的頁面
        // 通常用來顯示病患列表或進行病患選擇
        redirectUri: "patient-select.html",

        // FHIR Server 的 base URL（Issuer）
        // 這裡使用的是 THAS 模擬用的 R4 FHIR Server
        iss: "https://thas.mohw.gov.tw/v/r4/sim/WzIsIiIsIiIsIkFVVE8iLDAsMCwwLCIiLCIiLCIiLCIiLCIiLCIiLCIiLDAsMSwiIl0/fhir",

        // 啟用 PKCE（Proof Key for Code Exchange）
        // 提升 OAuth2 安全性
        pkce: true
    });
</script>
</body>
</html>
